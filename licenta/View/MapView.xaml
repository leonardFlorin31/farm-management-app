<UserControl x:Class="licenta.View.MapView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:licenta.View"
             xmlns:windowsPresentation="clr-namespace:GMap.NET.WindowsPresentation;assembly=GMap.NET.WindowsPresentation"
             mc:Ignorable="d"
             d:DesignHeight="300" d:DesignWidth="300"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:behavior="clr-namespace:licenta.Behavior"
             xmlns:viewModel="clr-namespace:licenta.ViewModel"
             xmlns:fa="http://schemas.awesome.incremented/wpf/xaml/fontawesome.sharp"
             xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls">
    <UserControl.Resources>
        <!-- Custom ToggleButton pentru ComboBox -->
        <!-- <ControlTemplate x:Key="CustomToggleButton" TargetType="ToggleButton"> -->
        <!--     <Grid> -->
        <!--         <Border Name="Border" Background="White" BorderBrush="Black" BorderThickness="1" /> -->
        <!--         <Grid> -->
        <!--             <ContentPresenter HorizontalAlignment="Left" Margin="5,0,25,0" VerticalAlignment="Center" /> -->
        <!--             <Path Name="Arrow" Fill="Black" -->
        <!--                   Data="M 0 0 L 4 4 L 8 0 Z" -->
        <!--                   HorizontalAlignment="Right" -->
        <!--                   VerticalAlignment="Center" -->
        <!--                   Margin="0,0,5,0" /> -->
        <!--         </Grid> -->
        <!--     </Grid> -->
        <!-- </ControlTemplate> -->
        <!-- -->
        <!-- ~1~ Custom ComboBox Style @1@ -->
        <!-- <Style TargetType="{x:Type ComboBox}"> -->
        <!--     <Setter Property="FrameworkElement.OverridesDefaultStyle" Value="True" /> -->
        <!--     <Setter Property="Background" Value="White" /> -->
        <!--     <Setter Property="Foreground" Value="Black" /> -->
        <!--     <Setter Property="FontSize" Value="15" /> -->
        <!--     <Setter Property="BorderBrush" Value="Black" /> -->
        <!--     <Setter Property="Padding" Value="4" /> -->
        <!--     <Setter Property="Control.Template"> -->
        <!--         <Setter.Value> -->
        <!--             <ControlTemplate TargetType="ComboBox"> -->
        <!--                 <Grid> -->
        <!--                     <ToggleButton Name="DropDownToggle" -->
        <!--                                   ClickMode="Press" -->
        <!--                                   IsChecked="{Binding IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}" -->
        <!--                                   Template="{StaticResource CustomToggleButton}" /> -->
        <!--                     <ContentPresenter Name="ContentSite" -->
        <!--                                       Content="{TemplateBinding SelectionBoxItem}" -->
        <!--                                       VerticalAlignment="Center" -->
        <!--                                       HorizontalAlignment="Left" -->
        <!--                                       Margin="5,0,0,0" /> -->
        <!--                     <Popup Name="Popup" -->
        <!--                            IsOpen="{TemplateBinding IsDropDownOpen}" -->
        <!--                            Placement="Bottom" -->
        <!--                            AllowsTransparency="True" -->
        <!--                            PopupAnimation="Slide"> -->
        <!--                         <Border BorderBrush="{TemplateBinding BorderBrush}" Background="White"> -->
        <!--                             <ScrollViewer> -->
        <!--                                 <ItemsPresenter /> -->
        <!--                             </ScrollViewer> -->
        <!--                         </Border> -->
        <!--                     </Popup> -->
        <!--                 </Grid> -->
        <!--             </ControlTemplate> -->
        <!--         </Setter.Value> -->
        <!--     </Setter> -->
        <!-- </Style> -->
    </UserControl.Resources>
    
    <UserControl.InputBindings>
        <KeyBinding Key="Z"
                    Modifiers="Control"
                    Command="{Binding UndoCommand}" />
        <KeyBinding Key="Y"
                    Modifiers="Control"
                    Command="{Binding RedoCommand}" />
    </UserControl.InputBindings>

   <Grid>
  <Grid.RowDefinitions>
    <RowDefinition Height="50" />
    <RowDefinition Height="*" />
  </Grid.RowDefinitions>

  <!-- Header cu controale -->
  <Grid Grid.Row="0" Background="{DynamicResource MahApps.Brushes.WhiteSmoke}">
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="Auto" />
      <ColumnDefinition Width="*" />
      <ColumnDefinition Width="Auto" />
    </Grid.ColumnDefinitions>

    <!-- Coloana stângă: Iconiță și titlu -->
    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="10,0">
      <!-- Icon-ul poate folosi stilul și culoarea din resurse -->
      <fa:IconImage Icon="Map" Style="{StaticResource menuButtonIcon}" 
                    Foreground="{DynamicResource AccentColorBrush}" 
                    Margin="10,0,5,0" />
      <TextBlock Text="Harta" 
                 FontSize="16" 
                 FontWeight="Bold" 
                 Foreground="Black"
                 VerticalAlignment="Center"/>
    </StackPanel>

    <!-- Coloana mijloc: Caseta de text și ComboBox -->
    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="10,0">
      <!-- TextBox cu Watermark (placeholder) -->
      <Grid Width="220" Height="30">
        <TextBox x:Name="InputTextBox"
                 Text="{Binding PolygonName, UpdateSourceTrigger=PropertyChanged}"
                 Background="White"
                 Padding="5"
                 Width="180" Height="30"
                 BorderThickness="1"
                 HorizontalContentAlignment="Left"
                 VerticalContentAlignment="Center"
                 mah:TextBoxHelper.Watermark="Introduceti numele parcelei..." />
      </Grid>
      <!-- ComboBox folosind stilurile MahApps implicite -->
      <ComboBox x:Name="comboBox"
                Width="120"
                ItemsSource="{Binding CenterPointNames}"
                SelectedItem="{Binding SelectedCenterPointName, Mode=TwoWay}"
                Style="{StaticResource {x:Type ComboBox}}">
          <i:Interaction.Triggers>
              <i:EventTrigger EventName="SelectionChanged">
                  <i:InvokeCommandAction Command="{Binding SelectionChangedCommand}" />
              </i:EventTrigger>
          </i:Interaction.Triggers>
      </ComboBox>
    </StackPanel>

            <!-- Coloana dreaptă: Butoane -->
            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Right" Margin="10,0" >
                <!-- Buton "Creaza parcela" -->
                <Button Content="Creaza parcela"
                        Command="{Binding CreatePolygonCommand}"
                        Width="100"
                        Height="30"
                        Padding="5"
                        Foreground="White"
                        BorderBrush="Transparent"
                        FontWeight="Bold"
                        Margin="0,0,5,0">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="{StaticResource color13}" />
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="{StaticResource titleColor2}" />
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border Width="100" Height="30"
                                    CornerRadius="20"
                                    Background="{TemplateBinding Background}">
                                <ContentPresenter VerticalAlignment="Center"
                                                  HorizontalAlignment="Center" />
                            </Border>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
                
                <!-- Buton "Schimba tipul hartii" -->
                <Button Content="Schimba tipul hartii"
                        Command="{Binding ChangeMapTypeCommand}"
                        Width="150"
                        Height="30"
                        Padding="5"
                        Foreground="White"
                        BorderBrush="Transparent"
                        FontWeight="Bold"
                        Margin="5,0,5,0">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="{StaticResource color13}" />
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="{StaticResource titleColor2}" />
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border Width="150" Height="30"
                                    CornerRadius="20"
                                    Background="{TemplateBinding Background}">
                                <ContentPresenter VerticalAlignment="Center"
                                                  HorizontalAlignment="Center" />
                            </Border>
                        </ControlTemplate>
                    </Button.Template>
                </Button>

                <!-- Buton "Sterge parcela" -->
                <Button Content="Sterge parcela"
                        Command="{Binding DeletePolygonCommand}"
                        Width="100"
                        Height="30"
                        Padding="5"
                        Foreground="White"
                        BorderBrush="Transparent"
                        FontWeight="Bold"
                        Margin="5,0,5,0">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="{StaticResource color14}" />
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="{StaticResource color12}" />
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border Width="100" Height="30"
                                    CornerRadius="20"
                                    Background="{TemplateBinding Background}">
                                <ContentPresenter VerticalAlignment="Center"
                                                  HorizontalAlignment="Center" />
                            </Border>
                        </ControlTemplate>
                    </Button.Template>
                </Button>

                <!-- Buton "Sterge ultimul marker" -->
                <Button Content="Sterge markerul selectat"
                        Command="{Binding DeleteLastMarkerCommand}"
                        Width="150"
                        Height="30"
                        Padding="5"
                        Foreground="White"
                        BorderBrush="Transparent"
                        FontWeight="Bold"
                        Margin="5,0,5,0">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background" Value="{StaticResource color14}" />
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="{StaticResource color12}" />
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border Width="150" Height="30"
                                    CornerRadius="20"
                                    Background="{TemplateBinding Background}">
                                <ContentPresenter VerticalAlignment="Center"
                                                  HorizontalAlignment="Center" />
                            </Border>
                        </ControlTemplate>
                    </Button.Template>
                </Button>

               
            </StackPanel>
        </Grid>

        <!-- Grid pentru hartă și alte elemente -->
        <Grid Grid.Row="1">
    <!-- Harta -->
    <ContentControl Content="{Binding MapControl}" />
    
    <StackPanel Orientation="Horizontal"
                HorizontalAlignment="Right"
                VerticalAlignment="Top"
                Margin="10">
        <Button Content="Undo"
                Command="{Binding UndoCommand}"
                Width="80"
                Height="30"
                Margin="0,0,5,0">
            <Button.Style>
                <Style TargetType="Button">
                    <Setter Property="Background" Value="{StaticResource color13}" />
                    <Setter Property="Foreground" Value="White"/>
                    <Setter Property="FontWeight" Value="Bold"/>
                    <Setter Property="Padding" Value="5"/>
                    <Style.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Background" Value="{StaticResource titleColor2}" />
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </Button.Style>
        </Button>
        <Button Content="Redo"
                Command="{Binding RedoCommand}"
                Width="80"
                Height="30">
            <Button.Style>
                <Style TargetType="Button">
                    <Setter Property="Background" Value="{StaticResource color13}" />
                    <Setter Property="Foreground" Value="White"/>
                    <Setter Property="FontWeight" Value="Bold"/>
                    <Setter Property="Padding" Value="5"/>
                    <Style.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Background" Value="{StaticResource titleColor2}" />
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </Button.Style>
        </Button>
    </StackPanel>

    <!-- Border-ul cu detalii despre parcelă -->
    <Border x:Name="ParcelDetailsBorder"
            Visibility="{Binding ParcelDetailsVisibility}"
            Width="{Binding BorderWidth}"
            Height="{Binding BorderHeight}"
            Background="White"
            BorderBrush="Black"
            BorderThickness="1"
            CornerRadius="5"
            HorizontalAlignment="Right"
            VerticalAlignment="Top"
            MouseLeftButtonDown="ParcelDetailsBorder_MouseLeftButtonDown"
            MouseMove="ParcelDetailsBorder_MouseMove"
            MouseLeftButtonUp="ParcelDetailsBorder_MouseLeftButtonUp"
            Margin="10,180,10,10"
            Padding="10">
        <Border.RenderTransform>
            <TranslateTransform x:Name="borderTranslateTransform" />
        </Border.RenderTransform>
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="140" />
                <ColumnDefinition Width="35" />
                <ColumnDefinition Width="100" />
            </Grid.ColumnDefinitions>
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <TextBlock Text="Nume Parcelă:" FontWeight="Bold" />
                <TextBlock Grid.Row="0"
                           Text="{Binding SelectedParcel.Field1}"
                           Foreground="Black"
                           Margin="0,20,0,0" />
                <TextBlock Grid.Row="1" Text="Tip Cultură:" FontWeight="Bold" />
                <TextBlock Grid.Row="1"
                           Text="{Binding SelectedParcel.Field2}"
                           Foreground="Black"
                           Margin="0,20,0,0" />
                <TextBlock Grid.Row="2" Text="Suprafață (ha):" FontWeight="Bold" />
                <TextBlock Grid.Row="2"
                           Text="{Binding SelectedParcel.Field3}"
                           Foreground="Black"
                           Margin="0,20,0,0" />
                <TextBlock Grid.Row="3" Text="Tip Irigare:" FontWeight="Bold" />
                <TextBlock Grid.Row="3"
                           Text="{Binding SelectedParcel.Field4}"
                           Foreground="Black"
                           Margin="0,20,0,0" />
                <TextBlock Grid.Row="4" Text="Îngrășământ (kg):" FontWeight="Bold" />
                <TextBlock Grid.Row="4"
                           Text="{Binding SelectedParcel.Field5}"
                           Foreground="Black"
                           Margin="0,20,0,0" />
                <TextBlock Grid.Row="5" Text="Pesticide (L):" FontWeight="Bold" />
                <TextBlock Grid.Row="5"
                           Text="{Binding SelectedParcel.Field6}"
                           Foreground="Black"
                           Margin="0,20,0,0" />
                <TextBlock Grid.Row="6" Text="Producție (kg):" FontWeight="Bold" />
                <TextBlock Grid.Row="6"
                           Text="{Binding SelectedParcel.Field7}"
                           Foreground="Black"
                           Margin="0,20,0,0" />
                <TextBlock Grid.Row="7" Text="Tip Sol:" FontWeight="Bold" />
                <TextBlock Grid.Row="7"
                           Text="{Binding SelectedParcel.Field8}"
                           Foreground="Black"
                           Margin="0,20,0,0" />
                <TextBlock Grid.Row="8" Text="Consum Apă (m³):" FontWeight="Bold" />
                <TextBlock Grid.Row="8"
                           Text="{Binding SelectedParcel.Field9}"
                           Foreground="Black"
                           Margin="0,20,0,0" />
            </Grid>
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <TextBlock Text="Nume Parcelă:" FontWeight="Bold" />
                <TextBlock Grid.Row="0"
                           Text="{Binding SelectedParcel2.Field1}"
                           Foreground="Black"
                           Margin="0,20,0,0" />
                <TextBlock Grid.Row="1" Text="Tip Animale:" FontWeight="Bold" />
                <TextBlock Grid.Row="1"
                           Text="{Binding SelectedParcel2.Field2}"
                           Foreground="Black"
                           Margin="0,20,0,0" />
                <TextBlock Grid.Row="2" Text="Număr Animale:" FontWeight="Bold" />
                <TextBlock Grid.Row="2"
                           Text="{Binding SelectedParcel2.Field3}"
                           Foreground="Black"
                           Margin="0,20,0,0" />
                <TextBlock Grid.Row="3" Text="Tip Mâncare:" FontWeight="Bold" />
                <TextBlock Grid.Row="3"
                           Text="{Binding SelectedParcel2.Field4}"
                           Foreground="Black"
                           Margin="0,20,0,0" />
                <TextBlock Grid.Row="4" Text="Consum Apă (m³):" FontWeight="Bold" />
                <TextBlock Grid.Row="4"
                           Text="{Binding SelectedParcel2.Field5}"
                           Foreground="Black"
                           Margin="0,20,0,0" />
                <TextBlock Grid.Row="5" Text="Vizite Veterinar:" FontWeight="Bold" />
                <TextBlock Grid.Row="5"
                           Text="{Binding SelectedParcel2.Field6}"
                           Foreground="Black"
                           Margin="0,20,0,0" />
                <TextBlock Grid.Row="6" Text="Eliminare deșeuri:" FontWeight="Bold" />
                <TextBlock Grid.Row="6"
                           Text="{Binding SelectedParcel2.Field7}"
                           Foreground="Black"
                           Margin="0,20,0,0" />
            </Grid>
            
        </Grid>
    </Border>

    <!-- Buton pentru afișare/inchidere border (plasat în colțul din dreapta jos) -->
    <Button Content="↑ Informatii parcele"
            HorizontalAlignment="Right"
            VerticalAlignment="Bottom"
            Margin="0,0,10,10"
            Command="{Binding ToggleParcelDetailsCommand}">
        <Button.Style>
            <Style TargetType="Button">
                <Setter Property="Background" Value="{StaticResource titleColor2}" />
                <Setter Property="Foreground" Value="White"/>
                <Setter Property="FontWeight" Value="Bold"/>
                <Setter Property="Padding" Value="5"/>
                <Style.Triggers>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="{StaticResource titleColor3}" />
                    </Trigger>
                </Style.Triggers>
            </Style>
        </Button.Style>
    </Button>
</Grid>
    </Grid>
</UserControl>